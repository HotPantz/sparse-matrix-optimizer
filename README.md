# sparse-matrix-optimizer

## Description
This project analyzes and optimizes the performance of sparse matrix-vector multiplication. It uses different compilers and optimization levels to evaluate execution time and efficiency. Tools like MAQAO ensure accurate performance measurements, focusing on scalability and stability while improving computational results.

---

## Project Structure

### Directories and Files
- **input-matrix/**:
  - `mat_dim_493039.txt`: Sparse matrix data file.
  - `mat_dim_59319.txt`: Sparse matrix data file.
  - `mat_test.txt`: Test sparse matrix data.
  - `mat_dim_493039.png`: Visualization of `mat_dim_493039.txt`.
  - `mat_dim_59319.png`: Visualization of `mat_dim_59319.txt`.
  - `plotmatrix.py`: Python script for visualizing sparse matrices.
  - `test.png`: Output visualization generated by `plotmatrix.py`.
- **main.cpp**: Main source code for sparse matrix-vector multiplication.
- **Makefile**: Build system configuration for compiling the project.
- **utils/**:
  - `anyoption.cpp / anyoption.h`: Utility for command-line argument parsing.
  - `ooo_cmdline.cpp / ooo_cmdline.h`: Custom utility for command-line management.

---

## Requirements

### Hardware
- A Linux system with stable power (e.g., laptop connected to AC).
- Multicore CPU with fixed frequency settings.

### Software
- GCC or Intel OneAPI (ICPX) compilers.
- Python with `numpy` and `matplotlib` packages.
- MAQAO profiling tools.

---

## Installation

1. Clone the repository or download the provided files.
2. Ensure the required software and libraries are installed.
3. Configure the environment:
    - Set CPU governors to "performance":
      ```bash
      sudo cpupower -c all frequency-set -g performance
      ```
    - Pin processes to specific cores:
      ```bash
      export OMP_PLACES=cores
      export OMP_PROC_BIND=close
      ```

---

## Usage

### Compilation
Use the Makefile to build the project:
```bash
make
```

### Running the Program
Run the compiled binary with the appropriate parameters:
```bash
./spmxv.exe -f input-matrix/mat_dim_493039.txt -t <num_threads> -r 20000
```
- `-f`: Path to the input matrix file.
- `-t`: Number of threads to use.
- `-r`: Number of repetitions (e.g., 5000 for stable timings).

### Visualizing Sparse Matrices
Run the Python script to generate a visualization of the input matrix:
```bash
python3 input-matrix/plotmatrix.py
```
The output will be saved as `input-matrix/test.png`.

---

## Optimization Steps

1. **Compiler Options**:
   - Use GCC and ICPX with optimization flags (`-O3`, `-Ofast`).
2. **Profiling**:
   - Utilize MAQAO modes (Standard, Stability, Scalability, Compare).
   - Analyze performance metrics like GFLOP/s and execution time.
3. **Analysis**:
   - Compare compiler performance and optimization impacts.
   - Evaluate scalability by varying core counts.

---

## Outputs

1. **Performance Metrics**: Execution time, GFLOP/s.
2. **Visualization**: Scatter plots of sparse matrix structure (e.g., `input-matrix/test.png`).
3. **MAQAO Reports**: Profiling results in HTML format.

---

## References

- [MAQAO Documentation](https://maqao.org/)
- [GCC Optimization Options](https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html)
- [Intel OneAPI Compilers](https://www.intel.com/content/www/us/en/developer/tools/oneapi/compilers.html)

---

## Author
- **Selyan KABLIA**

---

## License
This project is licensed under the [MIT License](https://opensource.org/licenses/MIT).
